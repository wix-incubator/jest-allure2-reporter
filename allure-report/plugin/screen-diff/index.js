!function(){var e=allure.getPluginSettings("screen-diff",{diffType:"diff"});function i(e){return'<div class="screen-diff__container"><img class="screen-diff__image" src="'+e+'"></div>'}function t(e,i){if(e.testStage&&e.testStage.attachments){var t=e.testStage.attachments.filter((function(e){return e.name===i}))[0];if(t)return"data/attachments/"+t.source}return null}var a=Backbone.Marionette.View.extend({regions:{subView:".screen-diff-view"},template:function(){return'<div class="screen-diff-view"></div>'},onRender:function(){var e=this.model.toJSON(),i=e.labels.filter((function(e){return"testType"===e.name}))[0],a=t(e,"diff"),n=t(e,"actual"),r=t(e,"expected");i&&"screenshotDiff"===i.value&&this.showChildView("subView",new f({diffImage:a,actualImage:n,expectedImage:r}))}}),n=Backbone.Marionette.View.extend({templateContext:function(){return this.options},template:function(e){return'<pre class="screen-diff-error">'+e.error+"</pre>"}}),r=Backbone.Marionette.View.extend({regions:{subView:".screen-diff-view"},template:function(){return'<div class="screen-diff-view"></div>'},onRender:function(){jQuery.getJSON(this.options.sourceUrl).then(this.renderScreenDiffView.bind(this),this.renderErrorView.bind(this))},renderErrorView:function(e){console.log(e),this.showChildView("subView",new n({error:e.statusText}))},renderScreenDiffView:function(e){this.showChildView("subView",new f({diffImage:e.diff,actualImage:e.actual,expectedImage:e.expected}))}}),f=Backbone.Marionette.View.extend({className:"pane__section",events:function(){return{['click [name="screen-diff-type-'+this.cid+'"]']:"onDiffTypeChange","mousemove .screen-diff__overlay":"onOverlayMove"}},initialize:function(e){this.diffImage=e.diffImage,this.actualImage=e.actualImage,this.expectedImage=e.expectedImage,this.radioName="screen-diff-type-"+this.cid},templateContext:function(){return{diffType:e.get("diffType"),diffImage:this.diffImage,actualImage:this.actualImage,expectedImage:this.expectedImage,radioName:this.radioName}},template:function(e){return e.diffImage||e.actualImage||e.expectedImage?'<h3 class="pane__section-title">Screen Diff</h3><div class="screen-diff__content"><div class="screen-diff__switchers"><label><input type="radio" name="'+e.radioName+'" value="diff"> Show diff</label><label><input type="radio" name="'+e.radioName+'" value="overlay"> Show overlay</label></div>'+(t=e.diffType,a=e.diffImage,n=e.actualImage,r=e.expectedImage,("diff"===t&&a?i(a):"overlay"===t&&r?'<div class="screen-diff__overlay screen-diff__container"><img class="screen-diff__image" src="'+r+'"><div class="screen-diff__image-over"><img class="screen-diff__image" src="'+n+'"></div></div>':n?i(n):"No diff data provided")+"</div>"):"";var t,a,n,r},adjustImageSize:function(e){var i=this.$(e.target);i.width(i.width())},onRender:function(){const i=e.get("diffType");this.$('[name="'+this.radioName+'"][value="'+i+'"]').prop("checked",!0),"overlay"===i&&this.$(".screen-diff__image-over img").on("load",this.adjustImageSize.bind(this))},onOverlayMove:function(e){var i=e.pageX,t=this.$(".screen-diff__container").scrollLeft(),a=i-e.currentTarget.getBoundingClientRect().left+t;this.$(".screen-diff__image-over").width(a)},onDiffTypeChange:function(i){e.save("diffType",i.target.value),this.render()}});allure.api.addTestResultBlock(a,{position:"before"}),allure.api.addAttachmentViewer("application/vnd.allure.image.diff",{View:r,icon:"fa fa-exchange"})}();